"use strict";!function(){function e(e){r=!0,c&&o(c)}function t(e){return"undefined"!=typeof io&&(e.data===YT.PlayerState.PLAYING&&c?(a(c),c=null,!0):void d.emit("updatevideo",{state:e.data,time:u.getCurrentTime()}))}function n(e){return"undefined"!=typeof io&&void d.emit("updateplaybackrate",e.data)}function o(e){return"undefined"!=typeof io&&"undefined"!=typeof e&&void("undefined"!=typeof u&&r?(i.innerHTML=e.title,l&&null!==s&&(clearInterval(s),s=null),u.loadVideoById(e.id,e.time,"default"),u.setPlaybackRate(e.rate),l&&(s=setInterval(function(){d.emit("syncvideo",{time:u.getCurrentTime(),ping:Date.now()})},1500))):c=e)}function a(e){switch(e.state){case YT.PlayerState.PLAYING:u.seekTo(e.time,!0),u.playVideo();break;case YT.PlayerState.PAUSED:u.pauseVideo();break;case YT.PlayerState.ENDED:u.stopVideo();break;case YT.PlayerState.BUFFERING:u.seekTo(e.time,!0)}}var i=document.getElementById("video-title"),d=null,u=null,l=!0,r=!1,c=null,s=null;window.onYouTubeIframeAPIReady=function(){u=new YT.Player("player",{width:560,height:315,playerVars:{autohide:!0,autoplay:!1,controls:!0,iv_load_policy:3,rel:!1},events:{onReady:e,onStateChange:t,onPlaybackRateChange:n}})},"undefined"!=typeof io?(d=io("http://localhost:8080"),d.on("startvideo",o),d.on("queuevideo",o),d.on("updatevideo",a),d.on("updateplaybackrate",function(e){return u.setPlaybackRate(e)}),d.on("syncvideo",function(e){console.log("synced ~"+(Date.now()-e.pong)+"ms ago.."),e.time+=Math.abs(Date.now()-e.pong)/1e3,console.log("interpolated: "+e.time),console.log("player diff: "+(e.time-u.getCurrentTime())),e.time-u.getCurrentTime()>.5&&(u.seekTo(e.time),console.log("synced"))})):console.error("socket.io server is not running.");var m=document.getElementById("queue-video");m.addEventListener("submit",function(e){if(e.preventDefault(),"undefined"==typeof io)return!1;var t=document.getElementById("video-url"),n=t.value,o=n.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);o&&fetch("https://noembed.com/embed?url="+n,{method:"get"}).then(function(e){return e.json()}).then(function(e){d.emit("queuevideo",{id:o[2],title:e.title,url:e.url,thumbnail:e.thumbnail_url}),t.value=""}).catch(function(e){console.log(e)})});var f=document.getElementById("create-a-room");f.addEventListener("click",function(e){e.preventDefault(),"undefined"==typeof io,document.getElementById("start-container").classList.add("disabled"),document.getElementById("main-container").classList.add("active"),d.emit("joinroom","testing123")})}();